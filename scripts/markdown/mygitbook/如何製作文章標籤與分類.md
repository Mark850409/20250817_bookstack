---
title: å¦‚ä½•è£½ä½œæ–‡ç« æ¨™ç±¤èˆ‡åˆ†é¡
updated: 2024-07-25 02:48:49Z
created: 2024-07-25 01:03:46Z
latitude: 25.0329694
longitude: 121.5654177
altitude: 0
tags:
  - Gitbook
  - categories
  - tags
---

# 1. å¦‚ä½•è£½ä½œæ–‡ç« æ¨™ç±¤èˆ‡åˆ†é¡

## 1.1. ç°¡ä»‹

å¯ä»¥åœ¨æ–‡ç« æœ€å¾Œå‘ˆç¾`åˆ†é¡`&`æ¨™ç±¤`

## 1.2. å°ˆæ¡ˆæ¶æ§‹
```
20240724_gitbook-plugin-tags-categories
â”œâ”€ .npmignore
â”œâ”€ assets
â”‚  â””â”€ plugin.css
â”œâ”€ CHANGELOG.md
â”œâ”€ custom-release-notes-generator.js
â”œâ”€ index.js
â”œâ”€ LICENSE
â”œâ”€ package-lock.json
â”œâ”€ package.json
â””â”€ README.md

```

## 1.3. ç›®éŒ„

- [1. å¦‚ä½•è£½ä½œæ–‡ç« æ¨™ç±¤èˆ‡åˆ†é¡](#1-å¦‚ä½•è£½ä½œæ–‡ç« æ¨™ç±¤èˆ‡åˆ†é¡)
  - [1.1. ç°¡ä»‹](#11-ç°¡ä»‹)
  - [1.2. å°ˆæ¡ˆæ¶æ§‹](#12-å°ˆæ¡ˆæ¶æ§‹)
  - [1.3. ç›®éŒ„](#13-ç›®éŒ„)
    - [1.3.1. äº‹å‰æº–å‚™](#131-äº‹å‰æº–å‚™)
    - [1.3.2. æ“ä½œæ­¥é©Ÿ](#132-æ“ä½œæ­¥é©Ÿ)
    - [1.3.3. å®Œæˆçµæœ](#133-å®Œæˆçµæœ)

### 1.3.1. äº‹å‰æº–å‚™

è«‹å…ˆåˆ°github `Fork`é€™å€‹å°ˆæ¡ˆåˆ°è‡ªå·±çš„æœ¬æ©Ÿç›®éŒ„ä¿®æ”¹

https://github.com/billryan/gitbook-plugin-tags

<!--more-->
### 1.3.2. æ“ä½œæ­¥é©Ÿ

è«‹å…ˆæ’°å¯«`.gitlab-ci.yml`


```yaml
stages:
  - semantic-release
  - npm-deploy
# 2 Change log ç‰ˆè™Ÿè®Šæ›´
semantic-release:
  stage: semantic-release
  image: node:latest
  rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
  script:
    - echo "//registry.npmjs.org/:_authToken=${NPM_TOKEN}" >> .npmrc
    - npm install semver
    - npm install -g --save-dev conventional-changelog-conventionalcommits semantic-release @semantic-release/changelog @semantic-release/gitlab @semantic-release/git @semantic-release/npm @semantic-release/release-notes-generator @semantic-release/gitlab-config
    - export GL_TOKEN=${GL_TOKEN}
    - GL_TOKEN=${GL_TOKEN} npx semantic-release
npm-deploy:
  stage: npm-deploy
  script:
    - echo "//registry.npmjs.org/:_authToken=${NPM_TOKEN}" >> .npmrc
    - npm publish
  needs:
    - semantic-release

```


è«‹å…ˆæ’°å¯«`index.js`


```javascript
var slug = require('github-slugid');
var eol = require('os').EOL;

var tags_map = {};
var categories_map = {};

module.exports = {
  book: {
    assets: './assets',
    css: [
      "plugin.css"
    ]
  },
  hooks: {
    'page:before': function(page) {
      if (this.output.name !== 'website') return page;

      // Generate tags.html page
      if (page.path === 'tags.md') {
        return generateTagsPage(tags_map, categories_map);
      }

      // Process tags and categories in the page content
      page.content = processTagsAndCategories(page.content, page);

      return page;
    },

    'page': function(page) {
      // Add end slogan to the page content only once
      if (!page.content.includes('end-slogan')) {
        return addEndSlogan(page);
      }

      return page;
    }
  }
};

// ç”Ÿæˆæ¨™ç±¤é 
function generateTagsPage(tags_map, categories_map) {
  let tagsContent = '<div class="tags-page">';
  
  tagsContent += '<h1>æˆ‘çš„ç­†è¨˜æ¨™ç±¤</h1>';
  for (let key in tags_map) {
    if (tags_map.hasOwnProperty(key)) {
      let tagHeader = `<h2 id="${slug(key)}">${key}</h2>`;
      tagsContent += tagHeader;
      tagsContent += '<ul>';
      tags_map[key].forEach(function(tag) {
        let tagBody = `<li><a href="${tag.url}">${tag.title}</a></li>`;
        tagsContent += tagBody;
      });
      tagsContent += '</ul>';
    }
  }

  tagsContent += '<h1>æˆ‘çš„ç­†è¨˜åˆ†é¡</h1>';
  for (let key in categories_map) {
    if (categories_map.hasOwnProperty(key)) {
      let categoryHeader = `<h2 id="${slug(key)}">${key}</h2>`;
      tagsContent += categoryHeader;
      tagsContent += '<ul>';
      categories_map[key].forEach(function(category) {
        let categoryBody = `<li><a href="${category.url}">${category.title}</a></li>`;
        tagsContent += categoryBody;
      });
      tagsContent += '</ul>';
    }
  }

  tagsContent += '</div>';
  return { content: tagsContent };
}

// è™•ç†æ¨™ç±¤å’Œåˆ†é¡
function processTagsAndCategories(content, page) {
  let hasTitle = false;

  return content.replace(/(tags|categories):\s*(.+)/gi, function(match, type, values) {
    if (!hasTitle) {
      hasTitle = true;
      // æ·»åŠ æ¨™é¡Œ
      return `<div style="text-align: center;">
                <h2>æœ¬æ–‡æ¨™ç±¤èˆ‡åˆ†é¡</h2>
                ${processTagsOrCategories(type, values, page)}
              </div>`;
    } else {
      // è™•ç†å…¶é¤˜æ¨™ç±¤æˆ–åˆ†é¡
      return processTagsOrCategories(type, values, page);
    }
  });
}


// è™•ç†æ¨™ç±¤å’Œåˆ†é¡
function processTagsAndCategories(content, page) {
  let hasTitle = false;

  // ä½¿ç”¨ å€‹æ›¿æ›å‡½æ•¸ä¾†è™•ç†æ¨™é¡Œçš„é¡¯ç¤º
  return content.replace(/(tags|categories):\s*(.+)/gi, function(match, type, values) {
    if (!hasTitle) {
      hasTitle = true;
      // æ·»åŠ æ¨™é¡Œå’Œè™•ç†æ¨™ç±¤æˆ–åˆ†é¡
      return `<div style="text-align: center;">
                <h3>å½¥çš„æ–‡ç« æ¨™ç±¤èˆ‡åˆ†é¡</h3>
                ${generateTagsOrCategoriesHTML(type, values, page)}
              </div>`;
    } else {
      // åªè™•ç†å¾ŒçºŒæ¨™ç±¤æˆ–åˆ†é¡
      return generateTagsOrCategoriesHTML(type, values, page);
    }
  });
}

// ç”Ÿæˆæ¨™ç±¤æˆ–åˆ†é¡çš„ HTML
function generateTagsOrCategoriesHTML(type, values, page) {
  const itemList = values.split(',').map(item => item.trim());

  // ç”Ÿæˆ HTML
  const html = itemList.map(item => 
    `<a class="${type}" href="../tags.html#${slug(item)}" style="margin: 0 10px;">
      <i class="fa ${type === 'tags' ? 'fa-tags' : 'fa-folder-open'}" aria-hidden="true"></i>${item}
    </a>`
  ).join('');

  // æ›´æ–° tags_map æˆ– categories_map
  itemList.forEach(function(item) {
    const map = (type.toLowerCase() === 'tags') ? tags_map : categories_map; // ç¢ºä¿å¤§å°å¯«ä¸å½±éŸ¿
    if (!map[item]) {
      map[item] = [];
    }
    map[item].push({
      url: page.path,
      title: page.title
    });
  });

  // è¿”å›è™•ç†éçš„ HTML
  return `<div style="text-align: center;"><div class="${type}-list clearfix">${html}</div></div>`;
}

// æ·»åŠ çµå°¾æ¨™èªåˆ°é é¢å…§å®¹
function addEndSlogan(page) {
  const endSlogan = '<div class="end-slogan" style="text-align:center;font-size:13px;letter-spacing:5px;user-select:none;color:#bbb;"><br>------------æœ¬æ–‡ç»“æŸå•¦<i class="fa fa-star"></i>æ„Ÿè°¢æ‚¨çš„é–±è®€------------<br><br></div>';
  // const separator = '<hr>';

  page.content += endSlogan;
  return page;
}

```

è«‹å…ˆæ’°å¯«`assets\plugin.css`

```css
.tags-page {
  padding: 20px;
}

.tags-page h1 {
  font-size: 28px;
  margin-bottom: 20px;
  border-bottom: 2px solid #eaeaea;
}

.tags-page h2 {
  margin-top: 30px;
  font-size: 24px;
  border-bottom: 1px solid #eaeaea;
  padding-bottom: 10px;
}

.tags-page ul {
  list-style: none;
  padding: 0;
}

.tags-page ul li {
  margin: 5px 0;
}

.tags-page ul li a {
  text-decoration: none;
  color: #3498db;
}

.tags-page ul li a:hover {
  text-decoration: underline;
}

.tags-list,
.categories-list {
  margin: 20px 0; /* å¢åŠ å‰åé—´è· */
}

.tags-list a,
.categories-list a {
  display: inline-block;
  padding: 5px 10px;
  margin: 5px;
  background-color: #f1f1f1;
  color: #333;
  text-decoration: none;
  border-radius: 3px;
}

.tags-list a:hover,
.categories-list a:hover {
  background-color: #3498db;
  color: white;
}

.fa-tags,
.fa-folder-open {
  margin-right: 10px; /* å¢åŠ å›¾æ ‡å’Œæ–‡å­—é—´è· */
}


```

è«‹å…ˆæ’°å¯«`package.json`

> [!note] å°æç¤º 
>  1. nameçš„åç¨±ä¸€å®šè¦æ”¹
>2. versionå¯ä»¥ä¸ç”¨æ”¹ï¼Œäº¤çµ¦èªæ„åŒ–ç‰ˆæœ¬è™•ç†ï¼Œæœƒè‡ªå‹•è·³è™Ÿ
>3. repositoryã€bugsã€homepageè«‹å°æ‡‰åˆ°è©²å°ˆæ¡ˆçš„gitlab
>4. npmPublishè¦è¨­ç‚ºtrueï¼Œä¸”message å®šè¦è¨­å®šï¼Œä¸ç„¶ä¸æœƒè‡ªå‹•è·³è™Ÿ


```json
{
    "name": "gitbook-plugin-tags-categories",
    "version": "1.0.14",
    "description": "Gitbook tags-categories for markhsu",
    "main": "index.js",
    "scripts": {
        "test": "echo \"Error: no test specified\" && exit 1",
        "semantic-release": "semantic-release"
    },
    "repository": {
        "type": "git",
        "url": "git+https://markweb.idv.tw:10443/gitbooknpmproject/gitbook-plugin-tags-categories.git"
    },
    "author": "å°å½¥",
    "license": "ISC",
    "bugs": {
        "url": "https://markweb.idv.tw:10443/gitbooknpmproject/gitbook-plugin-tags-categories/-/issues"
    },
    "homepage": "https://markweb.idv.tw:10443/gitbooknpmproject/gitbook-plugin-tags-categories/-/blob/master/README.md",
    "dependencies": {
        "semver": "^7.6.3"
    },
    "engines": {
        "gitbook": ">=3.0.0"
    },
    "release": {
        "extends": "@semantic-release/gitlab-config",
        "analyzeCommits": {
            "preset": "angular",
            "releaseRules": [
                {
                    "type": "feat",
                    "release": "minor"
                },
                {
                    "type": "fix",
                    "release": "patch"
                },
                {
                    "type": "docs",
                    "release": "patch"
                },
                {
                    "type": "style",
                    "release": "patch"
                },
                {
                    "type": "chore",
                    "release": "patch"
                },
                {
                    "type": "refactor",
                    "release": "patch"
                },
                {
                    "type": "test",
                    "release": "patch"
                },
                {
                    "type": "build",
                    "release": "patch"
                },
                {
                    "type": "ci",
                    "release": "patch"
                }
            ]
        },
        "plugins": [
            [
                "@semantic-release/commit-analyzer",
                {
                    "path": "./custom-release-notes-generator.js"
                }
            ],
            [
                "@semantic-release/release-notes-generator",
                {
                    "preset": "conventionalcommits",
                    "presetConfig": {
                        "types": [
                            {
                                "type": "feat",
                                "section": "âœ¨ æ–°å¢åŠŸèƒ½"
                            },
                            {
                                "type": "fix",
                                "section": "ğŸ éŒ¯èª¤ä¿®æ­£"
                            },
                            {
                                "type": "perf",
                                "section": "ğŸš€ æ•ˆèƒ½èª¿æ•´"
                            },
                            {
                                "type": "revert",
                                "section": "âª é€€ç‰ˆ"
                            },
                            {
                                "type": "docs",
                                "section": "ğŸ“ƒ æ–‡ä»¶èª¿æ•´",
                                "hidden": false
                            },
                            {
                                "type": "style",
                                "section": "ğŸŒˆ æ¨£å¼èª¿æ•´",
                                "hidden": false
                            },
                            {
                                "type": "chore",
                                "section": "ğŸ› ï¸ é‡å¤§æ›´æ–°",
                                "hidden": true
                            },
                            {
                                "type": "refactor",
                                "section": "ğŸ”¨ ç¨‹å¼ç¢¼é‡æ§‹",
                                "hidden": true
                            },
                            {
                                "type": "test",
                                "section": "ğŸ”¬ å–®å…ƒæ¸¬è©¦",
                                "hidden": false
                            },
                            {
                                "type": "build",
                                "section": "ğŸ”§ ç¨‹å¼é‡æ§‹",
                                "hidden": false
                            },
                            {
                                "type": "ci",
                                "section": "ğŸ æŒçºŒæ•´åˆ",
                                "hidden": false
                            },
                            {
                                "type": "other",
                                "section": "ğŸ”„ å…¶ä»–",
                                "hidden": false
                            }
                        ]
                    },
                    "parserOpts": {
                        "noteKeywords": [
                            "BREAKING CHANGE",
                            "BREAKING CHANGES",
                            "BREAKING"
                        ]
                    }
                }
            ],
            "@semantic-release/gitlab",
            [
                "@semantic-release/git",
                {
                    "assets": [
                        "package.json",
                        "package-lock.json",
                        "CHANGELOG.md"
                    ],
                    "message": "${nextRelease.type === 'major' ? 'ğŸ› ï¸chore(release):é€™æ¬¡æ˜¯é‡å¤§ç‰ˆæ›´!!!' : 'ğŸfeat/fix(release):é€™åªæ˜¯å°ç‰ˆæ›´!!!'}\n\n v${nextRelease.version} æ–°çš„å°ˆæ¡ˆç‰ˆæœ¬å·²é‡‹å‡º!!! [skip ci]"
                }
            ]
        ],
        "prepare": [
            "@semantic-release/changelog",
            "@semantic-release/npm",
            {
                "path": "@semantic-release/git",
                "assets": [
                    "package.json",
                    "package-lock.json",
                    "CHANGELOG.md"
                ],
                "npmPublish": true,
                "message": "${nextRelease.type === 'major' ? 'ğŸ› ï¸chore(release):é€™æ¬¡æ˜¯é‡å¤§ç‰ˆæ›´!!!' : 'ğŸfeat/fix(release):é€™åªæ˜¯å°ç‰ˆæ›´!!!'}\n\n v${nextRelease.version} æ–°çš„å°ˆæ¡ˆç‰ˆæœ¬å·²é‡‹å‡º!!! [skip ci]"
            }
        ],
        "generateNotes": {
            "path": "./custom-release-notes-generator.js"
        }
    }
}

```


### 1.3.3. å®Œæˆçµæœ

![](https://markweb.idv.tw/uploads/202407250906910.png)

![](https://markweb.idv.tw/uploads/202407250907168.png)
